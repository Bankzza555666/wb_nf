# ЁЯЪА р╕Др╕╣р╣Ир╕бр╕╖р╕нр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З Crontab Auto-Renewal SSH & VPN
## р╕кр╕│р╕лр╕гр╕▒р╕Ър╣Ар╕Лр╕┤р╕гр╣Мр╕Яр╣Ар╕зр╕нр╕гр╣Мр╕Чр╕╡р╣И /home/vps/server/

---

## ЁЯУЛ р╕гр╕▓р╕вр╕Бр╕▓р╕гр╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕Хр╣Йр╕нр╕Зр╕бр╕╡

### **Controller Files:**
```
/home/vps/server/controller/
тФЬтФАтФА cron_main.php           # ЁЯФз р╕лр╕ер╕▒р╕Б - р╕гр╕зр╕бр╕Чр╕╕р╕Бр╕Яр╕▒р╕Зр╕Бр╣Мр╕Кр╕▒р╕Щ
тФЬтФАтФА auto_renew_worker.php   # ЁЯФД р╕Хр╣Ир╕нр╕нр╕▓р╕вр╕╕р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ (SSH + VPN)
тФЬтФАтФА cleanup_ssh.php        # ЁЯЧСя╕П р╕ер╕Ъ SSH р╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕р╣Ар╕Бр╕┤р╕Щ 2 р╕зр╕▒р╕Щ
тФФтФАтФА cleanup_vpn.php        # ЁЯЧСя╕П р╕ер╕Ъ VPN р╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕р╣Ар╕Бр╕┤р╕Щ 2 р╕зр╕▒р╕Щ
```

### **Scripts:**
```
/home/vps/server/scripts/
тФЬтФАтФА install_cron.sh        # ЁЯЪА р╕кр╕Др╕гр╕┤р╕Ыр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З Crontab
тФЬтФАтФА test_cron.sh          # ЁЯзк р╕Чр╕Фр╕кр╕нр╕Ър╕гр╕░р╕Ър╕Ъ
тФФтФАтФА run_auto_renew_linux.sh # ЁЯПГ р╕гр╕▒р╕Щр╣Бр╕Ър╕Ъ manual
```

---

## ЁЯЪА р╕Бр╕▓р╕гр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З (1 р╕Др╕│р╕кр╕▒р╣Ир╕Зр╣Ар╕Фр╕╡р╕вр╕з)

```bash
# р╕гр╕▒р╕Щр╕кр╕Др╕гр╕┤р╕Ыр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З
bash /home/vps/server/scripts/install_cron.sh
```

**р╕кр╕Др╕гр╕┤р╕Ыр╕Щр╕╡р╣Йр╕Ир╕░:**
- тЬЕ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╕Ир╕│р╣Ар╕Ыр╣Зр╕Щ
- тЬЕ р╕кр╕гр╣Йр╕▓р╕З Crontab р╣Гр╕лр╕бр╣И (р╕Цр╣Йр╕▓р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡)
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕бр╕Др╕│р╕кр╕▒р╣Ир╕З auto-renewal (р╕Чр╕╕р╕Б 1 р╕Кр╕▒р╣Ир╕зр╣Вр╕бр╕З)
- тЬЕ р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓ log р╣Гр╕лр╣Йр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

---

## ЁЯзк р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ър╕гр╕░р╕Ър╕Ъ

```bash
# р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╣Ир╕нр╕Щр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕З
bash /home/vps/server/scripts/test_cron.sh

# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Crontab р╕Чр╕╡р╣Ир╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕Зр╣Бр╕ер╣Йр╕з
crontab -l

# р╕Фр╕╣ log р╣Бр╕Ър╕Ъ real-time
tail -f /var/log/auto_renew.log

# р╕гр╕▒р╕Щр╣Бр╕Ър╕Ъ manual (test)
/usr/bin/php /home/vps/server/controller/cron_main.php
```

---

## ЁЯУЛ р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щ

### **р╕Чр╕╕р╕Б 1 р╕Кр╕▒р╣Ир╕зр╣Вр╕бр╕З р╕Ир╕░р╕Чр╕│:**

#### ЁЯФД **Auto-Renewal**
- **SSH**: р╕Хр╣Ир╕нр╕нр╕▓р╕вр╕╕ +1 р╕зр╕▒р╕Щ (24 р╕Кр╕▒р╣Ир╕зр╣Вр╕бр╕Зр╕Бр╣Ир╕нр╕Щр╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕)
- **VPN**: р╕Хр╣Ир╕нр╕нр╕▓р╕вр╕╕ +1 р╕зр╕▒р╕Щ (24 р╕Кр╕▒р╣Ир╕зр╣Вр╕бр╕Зр╕Бр╣Ир╕нр╕Щр╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕)
- р╕лр╕▒р╕Бр╣Ар╕Др╕гр╕Фр╕┤р╕Хр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- р╕кр╣Ир╕З notification р╣Гр╕лр╣Й user

#### ЁЯЧСя╕П **Cleanup**
- **SSH**: р╕ер╕Ър╕Чр╕╡р╣Ир╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕р╣Ар╕Бр╕┤р╕Щ 2 р╕зр╕▒р╕Щ
- **VPN**: р╕ер╕Ър╕Чр╕╡р╣Ир╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕р╣Ар╕Бр╕┤р╕Щ 2 р╕зр╕▒р╕Щ  
- р╕ер╕Ър╕Ир╕▓р╕Б SSH/XUI server + database

---

## ЁЯФз р╕Бр╕▓р╕гр╕Ир╕▒р╕Фр╕Бр╕▓р╕г Crontab

```bash
# р╣Ар╕Ыр╕┤р╕Ф editor
crontab -e

# р╕Фр╕╣р╕Ыр╕▒р╕Ир╕Ир╕╕р╕Ър╕▒р╕Щ
crontab -l

# р╕ер╕Ър╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф (р╕Цр╣Йр╕▓р╕Ир╕░р╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕Зр╣Гр╕лр╕бр╣И)
crontab -r

# Restart cron service
sudo service cron restart
# р╕лр╕гр╕╖р╕н
sudo systemctl restart crond
```

---

## ЁЯУБ Log Files

```bash
# Log р╕лр╕ер╕▒р╕Бр╕Вр╕нр╕Зр╕гр╕░р╕Ър╕Ъ
/var/log/auto_renew.log

# Log р╕Вр╕нр╕З cron р╕Чр╕▒р╣Йр╕Зр╕гр╕░р╕Ър╕Ъ
/var/log/cron.log         # Ubuntu/Debian
/var/log/cron            # CentOS/RHEL

# Log р╕ар╕▓р╕вр╣Гр╕Щ project
/home/vps/server/logs/cron_jobs.log
```

---

## ЁЯЫая╕П р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓

### **тЭМ р╣Др╕бр╣Ир╕Юр╕Ъ PHP:**
```bash
# р╕лр╕▓ PHP path
which php
whereis php

# р╕Цр╣Йр╕▓р╣Др╕бр╣Ир╕бр╕╡р╣Гр╕Щ PATH р╣Гр╕Кр╣Й full path
/usr/bin/php р╕лр╕гр╕╖р╕н /usr/local/bin/php
```

### **тЭМ Permission denied:**
```bash
# р╕Хр╕▒р╣Йр╕З permission
chmod +x /home/vps/server/controller/cron_main.php
chmod 755 /var/log/
```

### **тЭМ р╣Др╕бр╣Ир╕Чр╕│р╕Зр╕▓р╕Щ:**
```bash
# р╕Фр╕╣ cron error
tail -f /var/log/cron.log

# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ mail р╕Вр╕нр╕З root (cron р╣Ар╕бр╕ер╣М error)
sudo mail
```

---

## тЪЩя╕П р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╣Бр╕Хр╣Ир╕З

### **р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕Др╕зр╕▓р╕бр╕Цр╕╡р╣И:**
```bash
# р╕Чр╕╕р╕Б 30 р╕Щр╕▓р╕Чр╕╡
*/30 * * * * /usr/bin/php /home/vps/server/controller/cron_main.php

# р╕Чр╕╕р╕Б 6 р╕Кр╕▒р╣Ир╕зр╣Вр╕бр╕З  
0 */6 * * * /usr/bin/php /home/vps/server/controller/cron_main.php

# р╕Чр╕╕р╕Бр╣Ар╕Чр╕╡р╣Ир╕вр╕Зр╕Др╕╖р╕Щ (2 AM)
0 2 * * * /usr/bin/php /home/vps/server/controller/cron_main.php
```

### **р╣Ар╕Ыр╕ер╕╡р╣Ир╕вр╕Щр╕зр╕▒р╕Щр╕ер╕Ъ:**
р╣Бр╕Бр╣Йр╣Др╕Вр╣Др╕Яр╕ер╣М:
- `controller/cleanup_ssh.php` (р╕Ър╕гр╕гр╕Чр╕▒р╕Ф 12: `$DAYS_AFTER_EXPIRY = 2`)
- `controller/cleanup_vpn.php` (р╕Ър╕гр╕гр╕Чр╕▒р╕Ф 12: `$DAYS_AFTER_EXPIRY = 2`)

---

## ЁЯОп р╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М

### **р╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ъ:**
- **http://your-domain.com/?p=my_ssh** - р╕лр╕Щр╣Йр╕▓ SSH
- **http://your-domain.com/?p=my_vpn** - р╕лр╕Щр╣Йр╕▓ VPN

**р╕Чр╕▒р╣Йр╕Зр╕кр╕нр╕Зр╕лр╕Щр╣Йр╕▓р╕Ир╕░р╣Бр╕кр╕Фр╕З:**
- тП░ Countdown р╕Бр╣Ир╕нр╕Щр╕ер╕Ъ (2 р╕зр╕▒р╕Щ)
- тЪая╕П р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╣Гр╕Бр╕ер╣Йр╕лр╕бр╕Фр╕нр╕▓р╕вр╕╕ (7 р╕зр╕▒р╕Щ)
- тЬЕ р╕кр╕Цр╕▓р╕Щр╕░р╕Хр╣Ир╕нр╕нр╕▓р╕вр╕╕р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
- ЁЯЧСя╕П р╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╣Ар╕бр╕╖р╣Ир╕нр╕Цр╕╣р╕Бр╕ер╕Ър╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤

---

## ЁЯПБ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕кр╕Цр╕▓р╕Щр╕░

```bash
# р╕кр╕Цр╕▓р╕Щр╕░ Cron
systemctl status cron

# PHP Version
php -v

# Disk space (р╕кр╕│р╕лр╕гр╕▒р╕Ъ log)
df -h

# Memory usage
free -h
```

---

**ЁЯОЙ р╣Ар╕бр╕╖р╣Ир╕нр╕Хр╕┤р╕Фр╕Хр╕▒р╣Йр╕Зр╣Ар╕кр╕гр╣Зр╕И р╕гр╕░р╕Ър╕Ър╕Ир╕░р╕Чр╕│р╕Зр╕▓р╕Щр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤р╕Чр╕╕р╕Б 1 р╕Кр╕▒р╣Ир╕зр╣Вр╕бр╕З!**